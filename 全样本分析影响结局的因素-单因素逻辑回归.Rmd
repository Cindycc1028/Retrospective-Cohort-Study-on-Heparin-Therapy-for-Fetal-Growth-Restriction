---
title: "model"
author: "Cindy"
date: "2025-02-25"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```
```{r}
# 加载必要的库
library(tidyverse)
library(readr)
library(dplyr)
# 检测文件编码
encoding_info <- guess_encoding("C://Users//Intern1//Desktop//数据.csv")
print(encoding_info)

# 根据检测结果读取文件
data <- read.csv("C://Users//Intern1//Desktop//数据.csv", 
                 stringsAsFactors = TRUE, 
                 fileEncoding = encoding_info$encoding[which.max(encoding_info$confidence)])
head(data)

# 将分类变量转换为因子
data$高龄产妇 <- as.factor(data$高龄产妇)
data$人工受精 <- as.factor(data$人工受精)
data$孕次分层 <- as.factor(data$孕次分层)
data$生育过 <- as.factor(data$生育过)
data$流产史 <- as.factor(data$流产史)
data$胎儿生长受限史 <- as.factor(data$胎儿生长受限史)
data$高血压疾病 <- as.factor(data$高血压疾病)
data$妊娠期肝内胆汁淤积症 <- as.factor(data$妊娠期肝内胆汁淤积症)
data$糖尿病 <- as.factor(data$糖尿病)
data$甲状腺疾病 <- as.factor(data$甲状腺疾病)
data$前置胎盘 <- as.factor(data$前置胎盘)
data$易栓症 <- as.factor(data$易栓症)
data$抗心磷脂抗体综合征 <- as.factor(data$抗心磷脂抗体综合征)
data$脐血流异常 <- as.factor(data$脐血流异常)
data$羊水少 <- as.factor(data$羊水少)
data$FGR其他相关合并症 <- as.factor(data$FGR其他相关合并症)
data$既小于10周难免流产的次数 <- as.factor(data$既往小于10周难免流产的次数)
data$既往有无大于10周流产或死胎 <- as.factor(data$既往有无大于10周流产或死胎)
data$fgroutcome <- as.factor(data$fgroutcome)
data$heparinuse <- as.factor(data$heparinuse)
data$住院治疗 <- as.factor(data$住院治疗)
data$络安命 <- as.factor(data$络安命)
data$维生素C <- as.factor(data$维生素C)
data$硫酸镁 <- as.factor(data$硫酸镁)
data$地塞米松 <- as.factor(data$地塞米松)
data$性别 <- as.factor(data$性别)
data$新生儿评分 <- as.factor(data$新生儿评分)
data$胎盘早剥 <- as.factor(data$胎盘早剥)
data$重度子痫前期 <- as.factor(data$重度子痫前期)
data$HELLP <- as.factor(data$HELLP)
data$与分娩孕周相比是否诊断FGR <- as.factor(data$与分娩孕周相比是否诊断FGR)
data$分娩时是否为重度FGR <- as.factor(data$分娩时是否为重度FGR)
# 设置因变量和自变量列表
dependent_var <- "fgroutcome"
independent_vars <- c("年龄", "高龄产妇", "人工受精", "孕次", "产次", "孕次分层", "生育过", "流产史", "胎儿生长受限史", "高血压疾病", "妊娠期肝内胆汁淤积症", "糖尿病", "甲状腺疾病", "前置胎盘", "易栓症", "抗心磷脂抗体综合征", "脐血流异常", "羊水少", "FGR其他相关合并症", "既往小于10周难免流产的次数", "既往有无大于10周流产或死胎", "身高", "本次妊娠孕前体重Kg", "分娩前体重Kg", "孕期体重增加Kg", "孕前体重指数", "孕期体重增加是否符合相应BMI值", "首次孕周", "肝素使用时间", "住院治疗", "络安命", "维生素C", "硫酸镁", "地塞米松", "性别", "出生体重g", "出生1分钟评分", "出生5分钟评分", "入住NICU", "分娩孕周", "新生儿评分", "胎盘早剥", "重度子痫前期", "HELLP", "与分娩孕周相比是否诊断FGR", "分娩时是否为重度FGR", "由首次及最后诊断")

# 创建一个空的列表来存储结果
results <- list()

# 批量进行单因子逻辑回归分析
for (var in independent_vars) {
  # 构建模型公式
  formula <- as.formula(paste(dependent_var, "~", var))
  
  # 拟合逻辑回归模型
  model <- glm(formula, data = data, family = binomial)
  
  # 获取模型摘要
  model_summary <- summary(model)
  
  # 提取系数和 p 值
  coef_data <- data.frame(
    Variable = var,
    Coefficient = model_summary$coefficients[2, "Estimate"],
    Std.Error = model_summary$coefficients[2, "Std. Error"],
    z.value = model_summary$coefficients[2, "z value"],
    p.value = model_summary$coefficients[2, "Pr(>|z|)"]
  )
  
  # 将结果添加到列表中
  results[[var]] <- coef_data
}

# 合并所有结果为一个数据框
results_df <- do.call(rbind, results)

# 打印结果
print(results_df)
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
